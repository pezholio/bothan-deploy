<p class="lead">To deploy your own Bothan to Heroku, fill out the form below and click 'Deploy'</p>
<%= @app %>
<form action="/deploy" method="post" id='deploy'>
  <div class="form-group">
    <label for="name">App name</label>
    <input type="text" name="name" class="form-control" id="name" aria-describedby="nameHelp" placeholder="Name of app">
    <small id="nameHelp" class="form-text text-muted">The title of your Bothan instance - i.e. 'My Awesome Metrics'</small>
  </div>

  <div class="form-group">
    <label for="description">App description</label>
    <input type="text" name= "description" class="form-control" id="description" aria-describedby="nameHelp" placeholder="Name of app">
    <small id="nameHelp" class="form-text text-muted">The description for your Bothan instance</small>
  </div>

  <button type="submit" class="btn btn-primary">
    Deploy
    <i class="fa fa-refresh fa-spin hidden" aria-hidden="true" id="loading"></i>
  </button>

</form>

<script src="//js.pusher.com/2.2/pusher.min.js"></script>
<script>
  $('#deploy').submit(function(e) {
    e.preventDefault();
    $('#loading').removeClass('hidden')
    url = $(this).attr('action')
    $.post(url, $( this ).serialize()).done(function( data ) {
      Pusher.host = 'ws-eu.pusher.com';
      Pusher.sockjs_host = 'sockjs-eu.pusher.com';
      var pusher = new Pusher('<%= ENV['PUSHER_KEY'] %>');
      var channel = pusher.subscribe('app_status');
      channel.bind('success', function(data) {
        alert(data.url);
      });
      channel.bind('failed', function(data) {
        alert(data.message);
      });
    });
  })
</script>
